import router from '@ohos.router'
import { ErrorInfo,IPOCalendarReq,Request,IPOCalendarResp} from 'SseCore'

let RequestMap = { "IPOCalendarReq": new IPOCalendarReq(), } as Record<string, Request>
@Entry
@Component
struct F10IPOCalendarResp {
  @State message: string = 'Hello World'
  @State myParams: Object = router.getParams();
  @State autoRefresh: boolean = true; // å¼€å…³æ§åˆ¶æ˜¯å¦è¿›è¡Œå®šæ—¶è¯·æ±‚
  private title: string = '';
  private request: Request = new Request();
  private param: Record<string, Object> = {};
  build() {
    Column() {
      Text(this.title).padding(5).margin({ bottom: 5 }).fontSize(20).border({ width: 2 }).width('90%')
      Scroll() {
        Text(this.message).width('90%').margin({ left: 15, right: 15, bottom: 5 }).backgroundColor(0xFF56CA6A)
          .padding({ left: 10, right: 10, top: 5, bottom: 25 })
      }
    }.padding({ top: 20 })
  }
  private intervalId?: number
  private sendReq(){
    for (let keyValue of Object.entries(this.param)) {
      Reflect.set(this.request, keyValue[0], keyValue[1]);
    }
    this.request.send({
      onSuccess:(resp:IPOCalendarResp) => {
        this.message = resp.toString();
        if (resp.item) {
          let sg : Record<string,string>[] = resp.item["sglist"] as Record<string,string>[]
          let zq : Record<string,string>[] = resp.item["zqlist"] as Record<string,string>[]
          let ss : Record<string,string>[] = resp.item["sslist"] as Record<string,string>[]
          let jjfx : Record<string,string>[] = resp.item["jjfxlist"] as Record<string,string>[]
          let wss : Record<string,string>[] = resp.item["wsslist"] as Record<string,string>[]
          let dss : Record<string,string>[] = resp.item["dsslist"] as Record<string,string>[]
          if (sg){
            if (sg.length > 0) {
              for (let i = 0; i < sg.length; i++) {
                let sgInfo : Record<string,string> = sg[i]
                if (this.param['type'] === 4) {
                  console.info(`è®¡åˆ’å‘è¡Œä»·åŒºé—´:${sgInfo['PRICE']}==ä¹°å–å•ä½:${sgInfo['TRANSUNIT']}==ä¸Šå¸‚æ—¥æœŸ:${sgInfo['LISTDATE']}==æ³•äººç½‘ä¸‹é…å”®ç”³è´­æ—¥æœŸèµ·å§‹æ—¥:${sgInfo['OFFPLABEGDATE']}==æ³•äººç½‘ä¸‹é…å”®ç”³è´­æ—¥æœŸæˆªæ­¢æ—¥:${sgInfo['OFFPLAENDDATE']}==è‚¡ç¥¨ä»£ç :${sgInfo['TRADINGCODE']}`)
                }else {
                  console.info(`ç”³è´­ä»£ç :${sgInfo['APPLYCODE']}==è‚¡ç¥¨ç®€ç§°:${sgInfo['SECUABBR']}==äº¤æ˜“ä»£ç :${sgInfo['TRADINGCODE']}==å®é™…å‘è¡Œä»·æ ¼:${sgInfo['ISSUEPRICE']}==é¢„ä¼°å‘è¡Œä»·æ ¼:${sgInfo['ISSUEPRICEPLAN']}==å‘è¡Œå¸‚ç›ˆç‡:${sgInfo['PEAISSUE']}==ä¸­ç­¾å…¬å‘Šæ—¥:${sgInfo['SUCCRESULTNOTICEDATE']}==ç”³è´­ä¸Šé™:${sgInfo['CAPPLYSHARE']}==ä¸­ç­¾ç‡:${sgInfo['ALLOTRATEON']}==ä¸Šå¸‚æ—¥æœŸ:${sgInfo['LISTINGDATE']}==ç”³è´­æ—¥æœŸ:${sgInfo['BOOKSTARTDATEON']}==å®é™…å‘è¡Œæ€»é‡:${sgInfo['ISSUESHARE']}==å®é™…ç½‘ä¸Šå‘è¡Œæ•°é‡:${sgInfo['ISSUESHAREON']}==å®é™…ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${sgInfo['CAPPLYPRICE']}==è®¡åˆ’å‘è¡Œæ€»é‡:${sgInfo['CISSUESHAREPLAN']}==è®¡åˆ’ç½‘ä¸Šå‘è¡Œé‡:${sgInfo['ISSUESHAREONPLAN']}==é¢„ä¼°ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${sgInfo['CAPPLYPRICEPLAN']}==é¡¶æ ¼ç”³è´­æ‰€éœ€èµ„é‡‘:${sgInfo['CAPPLYSHAREPLAN']}==æ˜¯å¦ç§‘åˆ›æ¿:${sgInfo['KEYCODE']}==ä¸Šå¸‚æ—¶å°šæœªç›ˆåˆ©:${sgInfo['ISPROFIT']}==æ˜¯å¦å­˜åœ¨æŠ•ç¥¨æƒå·®å¼‚:${sgInfo['ISDIFFVOTE']}==æ˜¯å¦å…·æœ‰åè®®æ§åˆ¶æ¶æ„:${sgInfo['ISVIEFRAME']}==å‘è¡Œåˆ¶åº¦:${sgInfo['ISSSYSTEM']}==æ˜¯å¦æ˜¯CDRç±»å‹:${sgInfo['SETYPE']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_X:${sgInfo['STOCKCBX']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_Y:${sgInfo['CDRCBY']}`)
                }
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›ä»Šæ—¥ç”³è´­æ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
          if (zq){
            if (zq.length > 0) {
              for (let i = 0; i < zq.length; i++) {
                let zqInfo : Record<string,string> = zq[i]
                console.info(`ç”³è´­ä»£ç :${zqInfo['APPLYCODE']}==è‚¡ç¥¨ç®€ç§°:${zqInfo['SECUABBR']}==äº¤æ˜“ä»£ç :${zqInfo['TRADINGCODE']}==å®é™…å‘è¡Œä»·æ ¼:${zqInfo['ISSUEPRICE']}==é¢„ä¼°å‘è¡Œä»·æ ¼:${zqInfo['ISSUEPRICEPLAN']}==å‘è¡Œå¸‚ç›ˆç‡:${zqInfo['PEAISSUE']}==ä¸­ç­¾å…¬å‘Šæ—¥:${zqInfo['SUCCRESULTNOTICEDATE']}==ç”³è´­ä¸Šé™:${zqInfo['CAPPLYSHARE']}==ä¸­ç­¾ç‡:${zqInfo['ALLOTRATEON']}==ä¸Šå¸‚æ—¥æœŸ:${zqInfo['LISTINGDATE']}==ç”³è´­æ—¥æœŸ:${zqInfo['BOOKSTARTDATEON']}==å®é™…å‘è¡Œæ€»é‡:${zqInfo['ISSUESHARE']}==å®é™…ç½‘ä¸Šå‘è¡Œæ•°é‡:${zqInfo['ISSUESHAREON']}==å®é™…ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${zqInfo['CAPPLYPRICE']}==è®¡åˆ’å‘è¡Œæ€»é‡:${zqInfo['CISSUESHAREPLAN']}==è®¡åˆ’ç½‘ä¸Šå‘è¡Œé‡:${zqInfo['ISSUESHAREONPLAN']}==é¢„ä¼°ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${zqInfo['CAPPLYPRICEPLAN']}==é¡¶æ ¼ç”³è´­æ‰€éœ€èµ„é‡‘:${zqInfo['CAPPLYSHAREPLAN']}==æ˜¯å¦ç§‘åˆ›æ¿:${zqInfo['KEYCODE']}==ä¸Šå¸‚æ—¶å°šæœªç›ˆåˆ©:${zqInfo['ISPROFIT']}==æ˜¯å¦å­˜åœ¨æŠ•ç¥¨æƒå·®å¼‚:${zqInfo['ISDIFFVOTE']}==æ˜¯å¦å…·æœ‰åè®®æ§åˆ¶æ¶æ„:${zqInfo['ISVIEFRAME']}==å‘è¡Œåˆ¶åº¦:${zqInfo['ISSSYSTEM']}==æ˜¯å¦æ˜¯CDRç±»å‹:${zqInfo['SETYPE']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_X:${zqInfo['STOCKCBX']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_Y:${zqInfo['CDRCBY']}`)
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›ä»Šæ—¥ä¸­ç­¾æ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
          if(ss){
            if (ss.length > 0) {
              for (let i = 0; i < ss.length; i++) {
                let ssInfo : Record<string,string> = ss[i]
                if (this.param['type'] === 4) {
                  console.info(`è®¡åˆ’å‘è¡Œä»·åŒºé—´:${ssInfo['PRICE']}==ä¹°å–å•ä½:${ssInfo['TRANSUNIT']}==ä¸Šå¸‚æ—¥æœŸ:${ssInfo['LISTDATE']}==æ³•äººç½‘ä¸‹é…å”®ç”³è´­æ—¥æœŸèµ·å§‹æ—¥:${ssInfo['OFFPLABEGDATE']}==æ³•äººç½‘ä¸‹é…å”®ç”³è´­æ—¥æœŸæˆªæ­¢æ—¥:${ssInfo['OFFPLAENDDATE']}==è‚¡ç¥¨ä»£ç :${ssInfo['TRADINGCODE']}`)
                }else {
                  console.info(`ç”³è´­ä»£ç :${ssInfo['APPLYCODE']}==è‚¡ç¥¨ç®€ç§°:${ssInfo['SECUABBR']}==äº¤æ˜“ä»£ç :${ssInfo['TRADINGCODE']}==å®é™…å‘è¡Œä»·æ ¼:${ssInfo['ISSUEPRICE']}==é¢„ä¼°å‘è¡Œä»·æ ¼:${ssInfo['ISSUEPRICEPLAN']}==å‘è¡Œå¸‚ç›ˆç‡:${ssInfo['PEAISSUE']}==ä¸­ç­¾å…¬å‘Šæ—¥:${ssInfo['SUCCRESULTNOTICEDATE']}==ç”³è´­ä¸Šé™:${ssInfo['CAPPLYSHARE']}==ä¸­ç­¾ç‡:${ssInfo['ALLOTRATEON']}==ä¸Šå¸‚æ—¥æœŸ:${ssInfo['LISTINGDATE']}==ç”³è´­æ—¥æœŸ:${ssInfo['BOOKSTARTDATEON']}==å®é™…å‘è¡Œæ€»é‡:${ssInfo['ISSUESHARE']}==å®é™…ç½‘ä¸Šå‘è¡Œæ•°é‡:${ssInfo['ISSUESHAREON']}==å®é™…ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${ssInfo['CAPPLYPRICE']}==è®¡åˆ’å‘è¡Œæ€»é‡:${ssInfo['CISSUESHAREPLAN']}==è®¡åˆ’ç½‘ä¸Šå‘è¡Œé‡:${ssInfo['ISSUESHAREONPLAN']}==é¢„ä¼°ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${ssInfo['CAPPLYPRICEPLAN']}==é¡¶æ ¼ç”³è´­æ‰€éœ€èµ„é‡‘:${ssInfo['CAPPLYSHAREPLAN']}==æ˜¯å¦ç§‘åˆ›æ¿:${ssInfo['KEYCODE']}==ä¸Šå¸‚æ—¶å°šæœªç›ˆåˆ©:${ssInfo['ISPROFIT']}==æ˜¯å¦å­˜åœ¨æŠ•ç¥¨æƒå·®å¼‚:${ssInfo['ISDIFFVOTE']}==æ˜¯å¦å…·æœ‰åè®®æ§åˆ¶æ¶æ„:${ssInfo['ISVIEFRAME']}==å‘è¡Œåˆ¶åº¦:${ssInfo['ISSSYSTEM']}==æ˜¯å¦æ˜¯CDRç±»å‹:${ssInfo['SETYPE']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_X:${ssInfo['STOCKCBX']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_Y:${ssInfo['CDRCBY']}`)
                }
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›ä»Šæ—¥ä¸Šå¸‚æ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
          if (jjfx){
            if (jjfx.length > 0) {
              for (let i = 0; i < jjfx.length; i++) {
                let jjfxInfo : Record<string,string> = jjfx[i]
                console.info(`ç”³è´­ä»£ç :${jjfxInfo['APPLYCODE']}==è‚¡ç¥¨ç®€ç§°:${jjfxInfo['SECUABBR']}==äº¤æ˜“ä»£ç :${jjfxInfo['TRADINGCODE']}==å®é™…å‘è¡Œä»·æ ¼:${jjfxInfo['ISSUEPRICE']}==é¢„ä¼°å‘è¡Œä»·æ ¼:${jjfxInfo['ISSUEPRICEPLAN']}==å‘è¡Œå¸‚ç›ˆç‡:${jjfxInfo['PEAISSUE']}==ä¸­ç­¾å…¬å‘Šæ—¥:${jjfxInfo['SUCCRESULTNOTICEDATE']}==ç”³è´­ä¸Šé™:${jjfxInfo['CAPPLYSHARE']}==ä¸­ç­¾ç‡:${jjfxInfo['ALLOTRATEON']}==ä¸Šå¸‚æ—¥æœŸ:${jjfxInfo['LISTINGDATE']}==ç”³è´­æ—¥æœŸ:${jjfxInfo['BOOKSTARTDATEON']}==å®é™…å‘è¡Œæ€»é‡:${jjfxInfo['ISSUESHARE']}==å®é™…ç½‘ä¸Šå‘è¡Œæ•°é‡:${jjfxInfo['ISSUESHAREON']}==å®é™…ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${jjfxInfo['CAPPLYPRICE']}==è®¡åˆ’å‘è¡Œæ€»é‡:${jjfxInfo['CISSUESHAREPLAN']}==è®¡åˆ’ç½‘ä¸Šå‘è¡Œé‡:${jjfxInfo['ISSUESHAREONPLAN']}==é¢„ä¼°ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${jjfxInfo['CAPPLYPRICEPLAN']}==é¡¶æ ¼ç”³è´­æ‰€éœ€èµ„é‡‘:${jjfxInfo['CAPPLYSHAREPLAN']}==æ˜¯å¦ç§‘åˆ›æ¿:${jjfxInfo['KEYCODE']}==ä¸Šå¸‚æ—¶å°šæœªç›ˆåˆ©:${jjfxInfo['ISPROFIT']}==æ˜¯å¦å­˜åœ¨æŠ•ç¥¨æƒå·®å¼‚:${jjfxInfo['ISDIFFVOTE']}==æ˜¯å¦å…·æœ‰åè®®æ§åˆ¶æ¶æ„:${jjfxInfo['ISVIEFRAME']}==å‘è¡Œåˆ¶åº¦:${jjfxInfo['ISSSYSTEM']}==æ˜¯å¦æ˜¯CDRç±»å‹:${jjfxInfo['SETYPE']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_X:${jjfxInfo['STOCKCBX']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_Y:${jjfxInfo['CDRCBY']}`)
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›å³å°†å‘è¡Œæ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
          if (wss){
            if (wss.length > 0) {
              for (let i = 0; i < wss.length; i++) {
                let wssInfo : Record<string,string> = wss[i]
                console.info(`ç”³è´­ä»£ç :${wssInfo['APPLYCODE']}==è‚¡ç¥¨ç®€ç§°:${wssInfo['SECUABBR']}==äº¤æ˜“ä»£ç :${wssInfo['TRADINGCODE']}==å®é™…å‘è¡Œä»·æ ¼:${wssInfo['ISSUEPRICE']}==é¢„ä¼°å‘è¡Œä»·æ ¼:${wssInfo['ISSUEPRICEPLAN']}==å‘è¡Œå¸‚ç›ˆç‡:${wssInfo['PEAISSUE']}==ä¸­ç­¾å…¬å‘Šæ—¥:${wssInfo['SUCCRESULTNOTICEDATE']}==ç”³è´­ä¸Šé™:${wssInfo['CAPPLYSHARE']}==ä¸­ç­¾ç‡:${wssInfo['ALLOTRATEON']}==ä¸Šå¸‚æ—¥æœŸ:${wssInfo['LISTINGDATE']}==ç”³è´­æ—¥æœŸ:${wssInfo['BOOKSTARTDATEON']}==å®é™…å‘è¡Œæ€»é‡:${wssInfo['ISSUESHARE']}==å®é™…ç½‘ä¸Šå‘è¡Œæ•°é‡:${wssInfo['ISSUESHAREON']}==å®é™…ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${wssInfo['CAPPLYPRICE']}==è®¡åˆ’å‘è¡Œæ€»é‡:${wssInfo['CISSUESHAREPLAN']}==è®¡åˆ’ç½‘ä¸Šå‘è¡Œé‡:${wssInfo['ISSUESHAREONPLAN']}==é¢„ä¼°ç½‘ä¸Šç”³è´­æ‰€éœ€èµ„é‡‘:${wssInfo['CAPPLYPRICEPLAN']}==é¡¶æ ¼ç”³è´­æ‰€éœ€èµ„é‡‘:${wssInfo['CAPPLYSHAREPLAN']}==æ˜¯å¦ç§‘åˆ›æ¿:${wssInfo['KEYCODE']}==ä¸Šå¸‚æ—¶å°šæœªç›ˆåˆ©:${wssInfo['ISPROFIT']}==æ˜¯å¦å­˜åœ¨æŠ•ç¥¨æƒå·®å¼‚:${wssInfo['ISDIFFVOTE']}==æ˜¯å¦å…·æœ‰åè®®æ§åˆ¶æ¶æ„:${wssInfo['ISVIEFRAME']}==å‘è¡Œåˆ¶åº¦:${wssInfo['ISSSYSTEM']}==æ˜¯å¦æ˜¯CDRç±»å‹:${wssInfo['SETYPE']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_X:${wssInfo['STOCKCBX']}==åŸºç¡€è‚¡ç¥¨(X)ä¸CDR(Y)çš„è½¬æ¢æ¯”ä¾‹_Y:${wssInfo['CDRCBY']}`)
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›æœªä¸Šå¸‚æ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
          if (dss) {
            if(dss.length > 0){
              for (let i = 0; i < dss.length; i++) {
                let dssInfo: Record<string,string> = dss[i]
                console.info(`ä¸Šå¸‚æ—¥æœŸ:${dssInfo['LISTINGDATE']}==å€ºåˆ¸ä»£ç :${dssInfo['TRADINGCODE']}==å¯è½¬å€ºåç§°:${dssInfo['SECUABBR']}==ä¸­ç­¾ç‡:${dssInfo['ALLOTRATEON']}==è½¬è‚¡ä»·æ ¼:${dssInfo['CONVERTPRICE']}==å¯¹åº”æ­£è‚¡ä»£ç :${dssInfo['STOCKTRADINGCODE']}==å¯¹åº”æ­£è‚¡åç§°:${dssInfo['STOCKSECUABBR']}==åŸè‚¡ä¸œé…å”®ä»£ç :${dssInfo['PREFERREDPLACINGCODE']}==å¯è½¬å€ºç”³è´­ä»£ç :${dssInfo['APPLYCODE']}==ç”³è´­æ—¥æœŸ:${dssInfo['BEGINDATE']}==å€ºåˆ¸å‘è¡Œæ€»é¢:${dssInfo['ISSUEVAL']}==ç½‘ä¸Šè®¤è´­æ•°é‡ä¸Šé™:${dssInfo['CAPPLYVOL']}==ç½‘ä¸‹è®¤è´­æ•°é‡ä¸Šé™:${dssInfo['OFFCAPPLYVOL']}==å‘è¡Œä»·æ ¼:${dssInfo['ISSUEPRICE']}`)
              }
            }else {
              console.warn("ğŸ’§ğŸ’§ğŸ’§æ¥å£è¿”å›å½“æ—¥å¾…ä¸Šå¸‚æ•°æ®ä¸ºç©ºğŸ’§ğŸ’§ğŸ’§")
            }
          }
        }
      },
      onFail:(err:ErrorInfo) => {
        console.info("F10IPODateResp error" + err.getMsg());
      }
    });
  }
  private startAutoRefresh() {
    this.stopAutoRefresh(); // å…ˆæ¸…é™¤å¯èƒ½å­˜åœ¨çš„å®šæ—¶å™¨
    this.intervalId = setInterval(() => {
      if (this.autoRefresh) {
        this.sendReq();
      }
    }, 3000);
  }

  private stopAutoRefresh() {
    if (this.intervalId) {
      clearInterval(this.intervalId);
      this.intervalId = undefined;
    }
  }

  async aboutToAppear() {
    let recordParam = this.myParams as Record<string, Object>;
    this.title = recordParam['title'] as string;
    this.param = recordParam['param'] as Record<string, Object>;
    this.request = RequestMap[recordParam['request'] as string];

    this.sendReq(); // ç«‹å³è¯·æ±‚ä¸€æ¬¡
    if (this.autoRefresh) {
      this.startAutoRefresh();
    }
  }

  aboutToDisappear() {
    this.stopAutoRefresh();
  }
}

