import router from '@ohos.router'
import { QuoteDetailReq,QuoteResp,ErrorInfo,QuoteItem,Request, AddValueModel, BrokerInfoItem } from 'SseCore'
let RequestMap = {
  "QuoteDetailReq": new QuoteDetailReq(),
} as Record<string, Request>
@Entry
@Component
struct QuoteDetailResponse {
  @State message: string = 'Hello World'
  @State myParams: Object = router.getParams();
  private title: string = '';
  private request: Request = new Request();
  private param: Record<string, Object> = {};
  build() {
    Column() {
      Text(this.title).padding(5).margin({ bottom: 5 }).fontSize(20).border({ width: 2 }).width('90%')
      Scroll() {
        Text(this.message).width('90%').margin({ left: 15, right: 15, bottom: 5 }).backgroundColor(0xFF56CA6A).padding({ left: 10, right: 10, top: 5, bottom: 25 })
      }
    }.padding({ top: 20 })
  }
  private intervalId?: number
  private sendReq(){
    for (let keyValue of Object.entries(this.param)) {
      Reflect.set(this.request, keyValue[0], keyValue[1]);
    }
    this.request.send({
      onSuccess: (resp: QuoteResp) => {   // å¿«ç…§å“åº”
        this.message = resp.toString();   // è¾“å‡ºresponseåˆ°æ‰‹æœºå±å¹•  stringç±»å‹
        let item: QuoteItem = resp.quoteItems!.at(0)
        let count:number = item.buyPrices?.length
        console.info('countğŸ’§ :' + count)
        if (resp.quoteItems) {
          for (let i = 0; i < resp.quoteItems.length; i++){
            let str:QuoteItem = resp.quoteItems.convertToArray()[i]
            // console.info(`è‚¡ç¥¨çŠ¶æ€:${str.status}ä»£ç :${str.id}=è‚¡ç¥¨åç§°:${str.name}=æ¢æ‰‹ç‡:${str.turnoverRate}=å‰5æ—¥æ¢æ‰‹ç‡:${str.turnoverRate5}=å‰10æ—¥æ¢æ‰‹ç‡:${str.turnoverRate10}=å‰20æ—¥æ¢æ‰‹ç‡:${str.turnoverRate20}=äº¤æ˜“æ—¶é—´:${str.datetime}=æ‹¼éŸ³:${str.pinyin}=å¸‚åœº:${str.market}=å­ç±»åˆ«:${str.subtype}=æœ€æ–°ä»·:${str.lastPrice}=æœ€é«˜ä»·:${str.highPrice}=æœ€ä½ä»·:${str.lowPrice}=ä»Šå¼€ä»·:${str.openPrice}=æ˜¨æ”¶ä»·:${str.preClosePrice}=æ¶¨è·Œæ¯”ç‡:${str.changeRate}=æ€»é‡:${str.volume}=å½“å‰æˆäº¤é‡:${str.nowVolume}=æ¢æ‰‹ç‡:${str.turnoverRate}=æ¶¨è·Œå¹…é™åˆ¶ç±»å‹:${str.upDownLimitType}=è·Œåœä»·:${str.limitDown}=æ¶¨åœä»·:${str.limitUP}=å‡ä»·:${str.averageValue}=æ¶¨è·Œ:${str.change}=æˆäº¤é‡‘é¢:${str.amount}=é‡æ¯”:${str.volumeRatio}=ä¹°ä¸€ä»·:${str.buyPrice}=å–ä¸€ä»·:${str.sellPrice}=å¤–ç›˜é‡:${str.buyVolume}=å†…ç›˜é‡:${str.sellVolume}=æ€»å€¼:${str.totalValue}=æ€»å€¼åªæœ‰æ¸¯è‚¡æœ‰å€¼:${str.HKTotalValue}=æµå€¼:${str.flowValue}=å‡€èµ„äº§:${str.netAsset}=PE(å¸‚ç›ˆ):${str.pe}=é™æ€å¸‚ç›ˆç‡:${str.pe2}=PB(å¸‚å‡€ç‡):${str.pb}=æ€»è‚¡æœ¬:${str.capitalization}=æµé€šè‚¡:${str.circulatingShares}=äº”æ¡£/åæ¡£ä¹°ä»·:${str.buyPrices}=äº”æ¡£/åæ¡£å–ä»·:${str.sellPrices}=äº”æ¡£/åæ¡£å§”æ‰˜æ€»ç¬”æ•°ï¼ˆä¹°ï¼‰:${str.buySingleVolumes}=äº”æ¡£/åæ¡£å§”æ‰˜æ€»ç¬”æ•°ï¼ˆå–ï¼‰:${str.sellSingleVolumes}=äº”æ¡£/åæ¡£ä¹°é‡:${str.buyVolumes}=äº”æ¡£/åæ¡£å–é‡:${str.sellVolumes}=æŒ¯å¹…æ¯”ç‡:${str.amplitudeRate}=æ”¶ç›Š:${str.receipts}=ä¸Šæ¶¨å®¶æ•°:${str.upCount}=å¹³ç›˜å®¶æ•°:${str.sameCount}=ä¸‹è·Œå®¶æ•°:${str.downCount}=æœŸæƒç±»å‹:${str.optionType}=æ¶¨è·Œå¹…:${str.changeRate}=æ¶¨è·Œæ ‡è¯†:${str.upDownFlag}=é™ä»·ä¹°æ•°é‡ä¸Šé™:${str.buyQtyUpperLimit}=é™ä»·å–æ•°é‡ä¸Šé™:${str.sellQtyUpperLimit}=å¸‚ä»·ä¹°æ•°é‡ä¸Šé™:${str.marketBuyQtyUpperLimit}=å¸‚ä»·å–æ•°é‡ä¸Šé™:${str.marketSellQtyUpperLimit}=ç›˜åæˆäº¤é‡:${str.afterHoursVolume}=ç›˜åæˆäº¤é¢:${str.afterHoursAmount}=ç›˜åæˆäº¤ç¬”æ•°:${str.afterHoursTransactionNumber}=ç›˜åæ’¤å•ä¹°ç¬”æ•°:${str.afterHoursWithdrawBuyCount}=ç›˜åæ’¤å•ä¹°æ•°é‡:${str.afterHoursWithdrawBuyVolume}=ç›˜åæ’¤å•å–ç¬”æ•°:${str.afterHoursWithdrawSellCount}=ç›˜åæ’¤å•å–æ•°é‡:${str.afterHoursWithdrawSellVolume}=ç›˜åå§”æ‰˜ä¹°å…¥æ€»é‡:${str.afterHoursBuyVolume}=ç›˜åå§”æ‰˜å–å‡ºæ€»é‡:${str.afterHoursSellVolume}==å‰3æ—¥æ¶¨è·Œå¹…:${str.changeRate3}==å‰60æ—¥æ¶¨è·Œå¹…:${str.changeRate60}==æ˜¨æ—¥æ¶¨è·Œå¹…:${str.yesterdayChangeRate}==ç”³è´­ç¬”æ•°wbn:${str.buy_cancel_count}==ç”³è´­æ•°é‡wba:${str.buy_cancel_num}==ç”³è´­é‡‘é¢wbm:${str.buy_cancel_amount}==èµå›ç¬”æ•°wsn:${str.sell_cancel_count}==èµå›æ•°é‡wsa:${str.sell_cancel_num}==èµå›é‡‘é¢wsm:${str.sell_cancel_amount}==æ€»å–é‡:${str.sumSell}==æ€»ä¹°é‡:${str.sumBuy}==å‡ä¹°ä»·:${str.averageBuy}==å‡å–ä»·:${str.averageSell}==å‰3æ—¥æ¶¨è·Œå¹…:${str.changeRate3}==å‰60æ—¥æ¶¨è·Œå¹…:${str.changeRate60}==æ˜¨æ—¥æ¶¨è·Œå¹…:${str.yesterdayChangeRate}==æ²ªæ·±äº¬æŒ‡æ•°æ¢æ‰‹ç‡:${str.indexTurnoverRate}==æ²ªæ·±äº¬æŒ‡æ•°æ€»å¸‚å€¼:${str.indexTotalValue}==æ²ªæ·±äº¬æŒ‡æ•°åŠ¨æ€å¸‚ç›ˆç‡:${str.indexTTM}==æ²ªæ·±äº¬æŒ‡æ•°å¸‚å‡€ç‡:${str.indexPB}==æ²ªæ·±å¸‚åœºETFåŸºé‡‘æŠ˜ä»·ç‡ï¼ˆæº¢ä»·ç‡ï¼‰:${str.premiumDiscountRates}==ETFç”³è´­ç¬”æ•°:${str.buy_cancel_count}==ETFç”³è´­æ•°é‡:${str.buy_cancel_num}==ETFç”³è´­é‡‘é¢:${str.buy_cancel_amount}==ETFèµå›ç¬”æ•°:${str.sell_cancel_count}==ETFèµå›æ•°é‡:${str.sell_cancel_num}==ETFèµå›é‡‘é¢:${str.sell_cancel_amount}`);
            console.info(`è‚¡ç¥¨çŠ¶æ€:${str.status}ä»£ç :${str.id}=è‚¡ç¥¨åç§°:${str.name}=æ¢æ‰‹ç‡:${str.turnoverRate}=å‰5æ—¥æ¢æ‰‹ç‡:${str.turnoverRate5}=å‰10æ—¥æ¢æ‰‹ç‡:${str.turnoverRate10}=å‰20æ—¥æ¢æ‰‹ç‡:${str.turnoverRate20}=äº¤æ˜“æ—¶é—´:${str.datetime}=æ‹¼éŸ³:${str.pinyin}=å¸‚åœº:${str.market}=å­ç±»åˆ«:${str.subtype}=æœ€æ–°ä»·:${str.lastPrice}=æœ€é«˜ä»·:${str.highPrice}=æœ€ä½ä»·:${str.lowPrice}=ä»Šå¼€ä»·:${str.openPrice}=æ˜¨æ”¶ä»·:${str.preClosePrice}=æ¶¨è·Œæ¯”ç‡:${str.changeRate}=æ€»é‡:${str.volume}=å½“å‰æˆäº¤é‡:${str.nowVolume}=æ¢æ‰‹ç‡:${str.turnoverRate}=æ¶¨è·Œå¹…é™åˆ¶ç±»å‹:${str.upDownLimitType}=è·Œåœä»·:${str.limitDown}=æ¶¨åœä»·:${str.limitUP}=å‡ä»·:${str.averageValue}=æ¶¨è·Œ:${str.change}=æˆäº¤é‡‘é¢:${str.amount}=é‡æ¯”:${str.volumeRatio}=ä¹°ä¸€ä»·:${str.buyPrice}=å–ä¸€ä»·:${str.sellPrice}=å¤–ç›˜é‡:${str.buyVolume}=å†…ç›˜é‡:${str.sellVolume}=æ€»å€¼:${str.totalValue}=æ€»å€¼åªæœ‰æ¸¯è‚¡æœ‰å€¼:${str.HKTotalValue}=æµå€¼:${str.flowValue}=å‡€èµ„äº§:${str.netAsset}=PE(å¸‚ç›ˆ):${str.pe}=é™æ€å¸‚ç›ˆç‡:${str.pe2}=PB(å¸‚å‡€ç‡):${str.pb}=æ€»è‚¡æœ¬:${str.capitalization}=æµé€šè‚¡:${str.circulatingShares}=äº”æ¡£/åæ¡£ä¹°ä»·:${str.buyPrices}=äº”æ¡£/åæ¡£å–ä»·:${str.sellPrices}=äº”æ¡£/åæ¡£å§”æ‰˜æ€»ç¬”æ•°ï¼ˆä¹°ï¼‰:${str.buySingleVolumes}=äº”æ¡£/åæ¡£å§”æ‰˜æ€»ç¬”æ•°ï¼ˆå–ï¼‰:${str.sellSingleVolumes}=äº”æ¡£/åæ¡£ä¹°é‡:${str.buyVolumes}=äº”æ¡£/åæ¡£å–é‡:${str.sellVolumes}=æŒ¯å¹…æ¯”ç‡:${str.amplitudeRate}=æ”¶ç›Š:${str.receipts}=ä¸Šæ¶¨å®¶æ•°:${str.upCount}=å¹³ç›˜å®¶æ•°:${str.sameCount}=ä¸‹è·Œå®¶æ•°:${str.downCount}=æœŸæƒç±»å‹:${str.optionType}=æ¶¨è·Œå¹…:${str.changeRate}=æ¶¨è·Œæ ‡è¯†:${str.upDownFlag}=é™ä»·ä¹°æ•°é‡ä¸Šé™:${str.buyQtyUpperLimit}=é™ä»·å–æ•°é‡ä¸Šé™:${str.sellQtyUpperLimit}=å¸‚ä»·ä¹°æ•°é‡ä¸Šé™:${str.marketBuyQtyUpperLimit}=å¸‚ä»·å–æ•°é‡ä¸Šé™:${str.marketSellQtyUpperLimit}=ç›˜åæˆäº¤é‡:${str.afterHoursVolume}=ç›˜åæˆäº¤é¢:${str.afterHoursAmount}=ç›˜åæˆäº¤ç¬”æ•°:${str.afterHoursTransactionNumber}=ç›˜åæ’¤å•ä¹°ç¬”æ•°:${str.afterHoursWithdrawBuyCount}=ç›˜åæ’¤å•ä¹°æ•°é‡:${str.afterHoursWithdrawBuyVolume}=ç›˜åæ’¤å•å–ç¬”æ•°:${str.afterHoursWithdrawSellCount}=ç›˜åæ’¤å•å–æ•°é‡:${str.afterHoursWithdrawSellVolume}=ç›˜åå§”æ‰˜ä¹°å…¥æ€»é‡:${str.afterHoursBuyVolume}=ç›˜åå§”æ‰˜å–å‡ºæ€»é‡:${str.afterHoursSellVolume}==å‰3æ—¥æ¶¨è·Œå¹…:${str.changeRate3}==å‰60æ—¥æ¶¨è·Œå¹…:${str.changeRate60}==æ˜¨æ—¥æ¶¨è·Œå¹…:${str.yesterdayChangeRate}==ç”³è´­ç¬”æ•°wbn:${str.buy_cancel_count}==ç”³è´­æ•°é‡wba:${str.buy_cancel_num}==ç”³è´­é‡‘é¢wbm:${str.buy_cancel_amount}==èµå›ç¬”æ•°wsn:${str.sell_cancel_count}==èµå›æ•°é‡wsa:${str.sell_cancel_num}==èµå›é‡‘é¢wsm:${str.sell_cancel_amount}==æ€»å–é‡:${str.sumSell}==æ€»ä¹°é‡:${str.sumBuy}==å‡ä¹°ä»·:${str.averageBuy}==å‡å–ä»·:${str.averageSell}`);
            if (str.buyBrokerInfos){      // ä¹°ç»æµå¸­ä½åˆ—è¡¨   åªæœ‰æ¸¯è‚¡æ‰æœ‰
              for (let element of str.buyBrokerInfos.values()!) {
                console.info("ID:" + element.id);
                console.info("è¯åˆ¸åç§°:" + element.corp);
                console.info("è¯åˆ¸å…¨å:" + element.corportion);
                console.info("ä¹°å–æ–¹å‘:" + element.state);  // 0å–1ä¹°
              }
            }
            if (str.buyPrices){
              if (str.buyPrices.values()) {
                for (let element of str.buyPrices.values()!) {
                  console.info("ä¹°ä»·ï¼š"+ element)
                }
              }
            }
            if (str.sellBrokerInfos){      // å–ç»æµå¸­ä½åˆ—è¡¨   åªæœ‰æ¸¯è‚¡æ‰æœ‰
              if (str.sellBrokerInfos.values()) {

              for (let element of str.sellBrokerInfos.values()!) {
                console.info("ID:" + element.id);
                console.info("è¯åˆ¸åç§°:" + element.corp);
                console.info("è¯åˆ¸å…¨å:" + element.corportion);
                console.info("ä¹°å–æ–¹å‘:" + element.state);  // 0å–1ä¹°
              }
              }
            }
            if (str.buyQtys) {        // ä¹°é˜Ÿåˆ—åˆ—è¡¨
              for (let element of str.buyQtys.values()!) {
                let ids= element.ids;
                let qyts = element.quantities
                console.info("ID:" + JSON.stringify(ids))
                console.info("ä¹°é‡:" + JSON.stringify(qyts))
              }
            }
            if (str.sellQtys) {     // å–é˜Ÿåˆ—åˆ—è¡¨
              for (let element of str.sellQtys.values()!) {
                let ids = element.ids;
                let qyts = element.quantities
                console.info("ID:" + JSON.stringify(ids))
                console.info("å–é‡:" + JSON.stringify(qyts))
              }
            }
          }
          if (resp.addValueModels) {
            for (let j = 0; j < resp.addValueModels.length; j++) {
              let str:AddValueModel = resp.addValueModels.convertToArray()[j]
              console.info(`è¯åˆ¸ä»£ç :${str.code}=è¶…å¤§å•ä¸»åŠ¨ä¹°å…¥æˆäº¤é‡:${str.ultraLargeBuyVolume}=è¶…å¤§å•ä¸»åŠ¨å–å‡ºæˆäº¤é‡:${str.ultraLargeSellVolume}=è¶…å¤§å•ä¸»åŠ¨å–å‡ºæˆäº¤é‡:${str.ultraLargeSellVolume}=è¶…å¤§å•ä¸»åŠ¨ä¹°å…¥æˆäº¤é¢:${str.ultraLargeBuyAmount}=è¶…å¤§å•ä¸»åŠ¨å–å‡ºæˆäº¤é¢:${str.ultraLargeSellAmount}=å¤§å•ä¸»åŠ¨ä¹°å…¥æˆäº¤é‡:${str.largeBuyVolume}`)
            }
          }
        }
      },
      onFail: (err: ErrorInfo) => {
        console.info("QuoteDetailRequest error:" + err.getMsg());
      } });
  }
  async aboutToAppear() {
    let recordParam = this.myParams as Record<string, Object>;
    this.title = recordParam['title'] as string;
    this.param = recordParam['param'] as Record<string, Object>;
    this.request = RequestMap[recordParam['request'] as string];
    this.sendReq()
  }
  aboutToDisappear(){
    clearInterval(this.intervalId)
  }
}